#!/bin/bash
# kubctl-0x03
# Script to apply rolling update on blue deployment and monitor it

DEPLOYMENT_NAME=django-blue       # Name of the deployment
SERVICE_URL=http://127.0.0.1:8000 # Replace with your ClusterIP or forwarded port

# 1. Apply the updated deployment (triggers rolling update)
echo "Applying updated blue deployment..."
kubectl apply -f blue_deployment.yaml

# 2. Monitor the rollout status
echo "Monitoring rollout status..."
kubectl rollout status deployment/$DEPLOYMENT_NAME

# 3. Test for downtime using curl in a loop
echo "Testing for downtime..."
for i in {1..10}
do
    curl -s -o /dev/null -w "%{http_code}\n" $SERVICE_URL
    sleep 2
done

# 4. Verify current pods
echo "Checking current pods..."
kubectl get pods
